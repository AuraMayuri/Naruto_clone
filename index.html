<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hand Debug Mode</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
}
video{
  position:absolute;
  width:100vw;
  height:100vh;
  object-fit:cover;
}
canvas{
  position:absolute;
  width:100vw;
  height:100vh;
}
</style>
</head>

<body>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script>

const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let holdStart = 0;

// ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
async function initCamera(){
  const stream = await navigator.mediaDevices.getUserMedia({
    video:{
      width:640,
      height:480,
      frameRate:24
    }
  });
  video.srcObject = stream;
}
initCamera();

// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ MediaPipe
const hands = new Hands({
  locateFile:(file)=>{
    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
  }
});

hands.setOptions({
  maxNumHands:2,
  modelComplexity:0,
  minDetectionConfidence:0.7,
  minTrackingConfidence:0.7
});

hands.onResults(results=>{

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(video,0,0,canvas.width,canvas.height);

  let detected = false;
  let distanceText = "No Hands";

  if(results.multiHandLandmarks &&
     results.multiHandLandmarks.length===2){

    const hand1 = results.multiHandLandmarks[0];
    const hand2 = results.multiHandLandmarks[1];

    const p1 = hand1[9];
    const p2 = hand2[9];

    const dx = p1.x - p2.x;
    const dy = p1.y - p2.y;
    const distance = Math.sqrt(dx*dx + dy*dy);

    distanceText = "Distance: " + distance.toFixed(3);

    // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÅ‡∏î‡∏á
    for(const landmarks of results.multiHandLandmarks){
      drawConnectors(ctx,landmarks,HAND_CONNECTIONS,
        {color:"lime",lineWidth:2});
      drawLandmarks(ctx,landmarks,
        {color:"red",lineWidth:1});
    }

    if(distance < 0.08){

      if(holdStart===0){
        holdStart = Date.now();
      }

      if(Date.now() - holdStart > 600){
        detected = true;
      }

    }else{
      holdStart=0;
    }
  }else{
    holdStart=0;
  }

  // üîé ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤ distance ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô
  ctx.fillStyle="white";
  ctx.font="24px Arial";
  ctx.fillText(distanceText,20,40);

  // üö® ‡∏ñ‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
  if(detected){
    ctx.fillStyle="red";
    ctx.font="bold 60px Arial";
    ctx.fillText("DETECTED!",canvas.width/2-150,canvas.height/2);
  }

});

// loop ‡∏™‡πà‡∏á‡πÄ‡∏ü‡∏£‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ mediapipe
async function detect(){
  await hands.send({image:video});
  requestAnimationFrame(detect);
}

video.addEventListener("loadeddata",()=>{
  detect();
});

</script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Clone Effect iPad</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
}
video{
  display:none;
}
canvas{
  position:absolute;
  top:0;
  left:0;
}
button{
  position:absolute;
  bottom:40px;
  left:50%;
  transform:translateX(-50%);
  padding:20px 40px;
  font-size:20px;
  z-index:10;
}
.flash{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:white;
  opacity:0;
  pointer-events:none;
}
</style>
</head>
<body>

<button onclick="cloneNow()">แยกร่าง!</button>
<div class="flash" id="flash"></div>

<video id="video" playsinline autoplay></video>
<canvas id="canvas"></canvas>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const flash = document.getElementById("flash");

let clones = [];

async function startCam(){
  const stream = await navigator.mediaDevices.getUserMedia({
    video:{ facingMode:"user" }
  });
  video.srcObject = stream;

  video.onloadedmetadata = ()=>{
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    drawLoop();
  };
}

function drawLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.drawImage(video,0,0,canvas.width,canvas.height);

  clones.forEach((img,i)=>{
    ctx.globalAlpha=0.5;
    ctx.drawImage(img,
      0,
      -50*(i+1),
      canvas.width,
      canvas.height
    );
  });

  ctx.globalAlpha=1;
  requestAnimationFrame(drawLoop);
}

function cloneNow(){
  const temp = document.createElement("canvas");
  temp.width = canvas.width;
  temp.height = canvas.height;
  temp.getContext("2d").drawImage(
    video,0,0,canvas.width,canvas.height
  );

  clones.push(temp);

  // flash effect
  flash.style.opacity=1;
  setTimeout(()=>flash.style.opacity=0,150);
}

startCam();
</script>

</body>
</html>
